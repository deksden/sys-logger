# (docs/logger/SYS_LOGGER.md, v0.6.1) SYS_LOGGER: "System Logger Subsystem" Подсистема логирования

Подсистема предоставляет единый механизм логирования для всей системы на основе pino с поддержкой уровней логирования, фильтрации по namespace, форматирования и ротации файлов. Основные возможности:

- Централизованное логирование через единый pino логгер
- Уровни логирования от trace до fatal
- Фильтрация сообщений по namespace через DEBUG
- Цветной вывод в консоль и запись в файлы
- Форматирование логов через pino-pretty
- Автоматическая ротация и архивирование
- Структурированные ошибки через SYS_ERRORS

Подсистема тесно интегрируется с:
- SYS_ERRORS для централизованной обработки ошибок
- Используется всеми другими подсистемами для логирования

## Концептуальная модель

### 1. Основные абстракции

#### Логгер (Logger)
- Центральная абстракция подсистемы
- Создается для конкретного модуля/компонента
- Может иметь namespace для фильтрации
- Предоставляет методы для разных уровней логирования
- Поддерживает структурированное логирование
- Обеспечивает единый интерфейс для всей системы

#### Транспорт (Transport)
- Определяет куда и как записываются логи
- Поддерживает множественные целевые потоки
- Управляет форматированием вывода через pino-pretty
- Обеспечивает ротацию файлов
- Контролирует синхронность записи

#### Уровни логирования (Log Levels)
- Иерархическая система важности сообщений
- От самого подробного (trace) до критического (fatal)
- Позволяет фильтровать вывод по важности
- Определяет формат и цвет сообщений через pino-pretty
- Влияет на место записи лога

### 2. Принципы работы

#### Единая точка логирования
- Все логи проходят через центральный логгер
- Гарантируется единый формат и обработка через pino
- Централизованное управление конфигурацией
- Общие правила фильтрации и форматирования

#### Namespace-based фильтрация
- Каждый логгер имеет свой namespace
- Фильтрация через переменную DEBUG
- Поддержка wildcard и negation паттернов
- Иерархическая структура namespace
- Возможность точечного включения/выключения

#### Структурированное логирование
- Логи хранят контекст в виде объектов
- Поддержка метаданных и меток
- Автоматическая сериализация данных через pino
- Специальная обработка ошибок через SYS_ERRORS
- Форматированный вывод в консоль через pino-pretty

#### Отказоустойчивость
- Fallback на консольный вывод при проблемах с файлами
- Автоматическое восстановление после ошибок
- Защита от потери данных при ротации
- Безопасное форматирование сообщений через pino
- Обработка ошибок через SYS_ERRORS

### 3. Паттерны использования

#### Создание логгера
- Один логгер на модуль/компонент
- Namespace отражает иерархию системы
- Переиспользование базового логгера
- Создание дочерних логгеров с доп. контекстом

#### Уровни логирования
- trace: входные параметры и детали выполнения функций
- debug: результаты операций и состояния
- info: важные бизнес-события
- warn: некритичные проблемы и предупреждения
- error: ошибки выполнения операций
- fatal: критические системные ошибки

#### Структурированный контекст
- Группировка связанной информации
- Стандартные поля для типовых данных
- Специальная обработка ошибок через pino
- Добавление меток и метаданных

#### Управление выводом
- Фильтрация через DEBUG
- Настройка через переменные окружения
- Конфигурация форматирования через pino-pretty
- Управление ротацией файлов

## Структура 

### Подсистемы

Вложенных подсистем нет.

### Список файлов

```
src/logger/
 ├── logger.js         # Основной модуль, API подсистемы
 ├── config.js         # Загрузка и валидация конфигурации
 └── rotate.js         # Управление ротацией файлов
```

## Общий типовой интерфейс

### Dependency Injection

Все модули подсистемы поддерживают единый интерфейс dependency injection:

```javascript
/**
 * Зависимости модуля
 * @type {Object}
 */
export const dependencies;

/**
 * Устанавливает зависимости модуля
 * @param {Partial<typeof dependencies>} newDependencies - Новые зависимости
 */
export function setDependencies(newDependencies);
```

### Централизованная обработка ошибок (SYS_ERRORS), коды ошибок:

```javascript
LOGGER_ERROR_CODES:

  // Ошибки конфигурации
  CONFIG_LOAD_FAILED: Ошибка загрузки конфигурации логгера
    - context:
      - reason: причина ошибки

  INVALID_LOG_LEVEL: Некорректный уровень логирования
    - context:
      - level: некорректный уровень

  // Ошибки файловой системы  
  LOG_DIR_CREATE_FAILED: Ошибка создания директории логов
    - context:
      - path: путь к директории
      - reason: причина ошибки

  LOG_FILE_WRITE_FAILED: Ошибка записи в файл лога
    - context:
      - path: путь к файлу
      - reason: причина ошибки

  // Ошибки ротации логов
  ROTATE_FAILED: Ошибка ротации лог файла
    - context:
      - path: путь к файлу
      - reason: причина ошибки

  CLEANUP_FAILED: Ошибка очистки старых архивов
    - context:
      - reason: причина ошибки

  // Ошибки транспорта
  TRANSPORT_INIT_FAILED: Ошибка инициализации транспорта
    - context:
      - reason: причина ошибки
```

### Логирование (SYS_LOGGER), определены namespace:

```javascript
(config.js) "logger:config" Конфигурация логгера
(logger.js) "logger" Основной модуль логирования
(rotate.js) "logger:rotate" Ротация лог файлов
```
